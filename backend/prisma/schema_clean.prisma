// ============================================================
// PRISMA SCHEMA - DATABASE STRUCTURE
// ============================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================
// MODELS
// ============================================================

// USER MODEL - Thông tin đăng nhập và cơ bản
model User {
  id        Int     @id @default(autoincrement())
  
  // Authentication
  email     String  @unique
  password  String
  
  // Basic Info
  fullName  String
  phone     String?
  avatar    String?
  
  // Role
  role      Role    @default(STUDENT)
  
  // Relationships
  studentProfile     Student?
  tutorProfile       Tutor?
  bookingsAsStudent  Booking[] @relation("UserStudentBookings")
  bookingsAsTutor    Booking[] @relation("UserTutorBookings")
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// STUDENT MODEL - Hồ sơ học sinh
model Student {
  id          Int     @id @default(autoincrement())
  userId      Int     @unique
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Education Info
  grade       String?
  school      String?
  subjects    String[]
  bio         String?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// TUTOR MODEL - Hồ sơ gia sư
model Tutor {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Specialization
  specialization String[]
  experience     Int?
  qualification  String?
  bio            String?
  
  // Pricing
  hourlyRate     Float    @default(100000)
  
  // Ratings
  rating         Float?   @default(0)
  totalReviews   Int      @default(0)
  
  // Status
  isVerified     Boolean  @default(false)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// BOOKING MODEL - Lịch đặt học
model Booking {
  id            Int           @id @default(autoincrement())
  
  // Foreign Keys
  studentId     Int
  tutorId       Int
  
  // Relationships
  student       User          @relation("UserStudentBookings", fields: [studentId], references: [id], onDelete: Cascade)
  tutor         User          @relation("UserTutorBookings", fields: [tutorId], references: [id], onDelete: Cascade)
  
  // Booking Details
  subject       String
  status        BookingStatus @default(PENDING)
  
  // Scheduling
  scheduledDate DateTime
  duration      Int
  notes         String?
  
  // Pricing
  totalPrice    Float
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================================
// ENUMS
// ============================================================

enum Role {
  STUDENT
  TUTOR
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}
